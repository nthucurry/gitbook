input {
  beats {
    host => "t-elk"
    port => "1050"
    codec => "json"
  }
}

filter {
  json {
    source => "message"
    target => "log"
  }

  mutate {
    remove_field => [ "path", "host", "agent", "cloud", "log" ]
  }

  mutate {
    remove_field => [ "correlationId", "ReleaseVersion" ]
  }

  split { field => "[identity]" }
  split { field => "[identity][authorization]" }
  split { field => "[identity][authorization][evidence]" }
  split { field => "[identity][claims]" }

  mutate {
    remove_field => [ "[identity][authorization][evidence][principalId]" ]
    remove_field => [ "[identity][authorization][evidence][roleAssignmentId]" ]
    remove_field => [ "[identity][authorization][evidence][roleDefinitionId]" ]
    remove_field => [ "[identity][claims][aio]" ]
    remove_field => [ "[identity][claims][appid]" ]
    remove_field => [ "[identity][claims][appidacr]" ]
    remove_field => [ "[identity][claims][aud]" ]
    remove_field => [ "[identity][claims][exp]" ]
    remove_field => [ "[identity][claims][groups]" ]
    remove_field => [ "[identity][claims][iat]" ]
    remove_field => [ "[identity][claims][iss]" ]
    remove_field => [ "[identity][claims][nbf]" ]
    remove_field => [ "[identity][claims][onprem_sid]" ]
    remove_field => [ "[identity][claims][puid]" ]
    remove_field => [ "[identity][claims][rh]" ]
    remove_field => [ "[identity][claims][uti]" ]
    remove_field => [ "[identity][claims][ver]" ]
    remove_field => [ "[identity][claims][idtyp]" ]
    remove_field => [ "[identity][claims][wids]" ]
    remove_field => [ "[identity][claims][xms_az_tm]" ]
    remove_field => [ "[identity][claims][xms_mirid]" ]
    remove_field => [ "[identity][claims][xms_tcdt]" ]
  }
}

output {
  elasticsearch {
    hosts => "http://t-elk:9200"
    #user => "elastic"
    #password => "password"
    index => "azure-activity-%{+YYYY.MM.dd}"
  }
}