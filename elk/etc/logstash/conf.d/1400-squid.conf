input {
  beats {
    host => "filebeat"
    port => "1400"
  }
}

filter {
  mutate {
    remove_field => [ "path", "host", "agent", "cloud", "log", "ecs", "log_type", "message" ]
  }

  grok {
    match => { "message" =>
      "%{NUMBER:timestamp}\s+%{NUMBER:response_time} %{IPORHOST:src_ip} %{NOTSPACE:squid_request_status}/%{NUMBER:http_status_code} %{NUMBER:transfer_size} %{NOTSPACE:http_method} (%{URIPROTO:url_scheme}://)?(?<url_host>\S+?)(:%{INT:url_port})?(/%{NOTSPACE:url_path})?\s+%{NOTSPACE:client_identity}\s+%{NOTSPACE:peer_code}/%{NOTSPACE:peerhost}\s+%{NOTSPACE:content_type}" }
  }
}

output {
  elasticsearch {
    hosts => "http://t-elk:9200"
    #user => "elastic"
    #password => "password"
    index => "squid-%{+YYYY.MM.dd}"
  }
}